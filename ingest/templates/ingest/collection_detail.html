{% extends 'ingest/base.html' %}

{% block content %}
{% if pi %}
<a href="{% url 'ingest:index' %}">
  <button class="cancel btn btn btn-primary" value="ignore" formnovalidate="">Return to PI Dashboard</button>
</a>
{% endif %}
<div class="content container-fluid">
  <div class="row">
    <div class="col-md-6">
      <h1><b>Submission Name</b> {{ collection.name }} 
        {% if collection.locked %}<i class="fa fa-lock"></i>
        {% else %}<i class="fa fa-unlock"></i>
        {% endif %}
      </h1>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">

      <div class="list-group">
        <a href="#" class="list-group-item"><h4 class="list-group-item-heading">Submission Description</h4> {{collection.description}}</a>
        <a href="#" class="list-group-item"><h4 class="list-group-item-heading">Organization</h4> {{collection.organization_name}}</a>
        <a href="#" class="list-group-item"><h4 class="list-group-item-heading">Lab</h4> {{collection.lab_name}}</a>
        <a href="#" class="list-group-item"><h4 class="list-group-item-heading">Project funder</h4> {{collection.project_funder}}</a>
        <a href="#" class="list-group-item"><h4 class="list-group-item-heading">Project funder ID</h4> {{collection.project_funder_id}}</a>
        <a href="#" class="list-group-item"><h4 class="list-group-item-heading">Data staging area </h4> {{collection.data_path}}</a>

        {% if collection.validation_status == "NOT_VALIDATED" %}
        <a href="{% url 'ingest:collection_validation_results' pk=collection.pk %}" class="list-group-item list-group-item-info"><h4 class="list-group-item-heading">Validation Status</h4> Not validated</a>
        {% elif collection.validation_status == "PENDING" %}
        <a href="{% url 'ingest:collection_validation_results' pk=collection.pk %}" class="list-group-item list-group-item-warning"><h4 class="list-group-item-heading">Validation Status</h4> Validation pending</a>
        {% elif collection.validation_status == "SUCCESS" %}
        <a href="{% url 'ingest:collection_validation_results' pk=collection.pk %}" class="list-group-item list-group-item-success"><h4 class="list-group-item-heading">Validation Status</h4> Validation successful. [Click to view validation log].</a>
        {% elif collection.validation_status == "FAILED" %}
        <a href="{% url 'ingest:collection_validation_results' pk=collection.pk %}" class="list-group-item list-group-item-danger"><h4 class="list-group-item-heading">Validation Status</h4> Validation failed. [Click to view validation log]</a>
        {% endif %}

        {% if collection.submission_status == "NOT_SUBMITTED" %}
        <a href="{% url 'ingest:collection_submission_results' pk=collection.pk %}" class="list-group-item list-group-item-info"><h4 class="list-group-item-heading">Submission Status</h4> Not submitted</a>
        {% elif collection.submission_status == "PENDING" %}
        <a href="{% url 'ingest:collection_submission_results' pk=collection.pk %}" class="list-group-item list-group-item-warning"><h4 class="list-group-item-heading">Submission Status</h4> Submition pending</a>
        {% elif collection.submission_status == "SUCCESS" %}
        <a href="{% url 'ingest:collection_submission_results' pk=collection.pk %}" class="list-group-item list-group-item-success"><h4 class="list-group-item-heading">Submission Status</h4> Submission successful. [Click to view submission log].</a>
        {% elif collection.submission_status == "FAILED" %}
        <a href="{% url 'ingest:collection_submission_results' pk=collection.pk %}" class="list-group-item list-group-item-danger"><h4 class="list-group-item-heading">Submission Status</h4> Submission failed. [Click to view submission log]</a>
        {% endif %}

      </div>

      {% if descriptive_metadata_queryset %}
        <div class="panel panel-default">
          <div class="panel-heading" data-toggle="collapse" data-target="#collapseOrderMetadata"> Metadata <i class="chevron fa fa-fw" ></i></div>
          <div class="collapse in" id="collapseOrderMetadata">
            {% load render_table from django_tables2 %}
            {% render_table table %}
          </div>
        </div>
        {% if collection.locked %}
          <div class="alert alert-info">
            <strong>Locked submissions cannot be modified or deleted.</strong>
          </div>
        {% endif %}
      {% else %}
        <div class="alert alert-info">
          <strong>This submission doesn't have any Metadata Version 1.</strong>
        </div>
      {% endif %}
      <div><a href="{% url 'ingest:ondemandSubmission' collection.id %}">
        <button class="btn btn-lg btn-primary" value="ignore" formnovalidate="">View Submission Directory</button>
      </a></div>
      <p>

      <table>
      <tr>           
      <!--{% if descriptive_metadata_queryset %}
      <form action="" method="post">{% csrf_token %}
          <button type="submit" class="cancel btn btn-primary" value="Validate" name="validate_collection">Validate</button>
          &nbsp;
          &nbsp;
      </form>       
      {% endif %}-->

      <a href="{% url 'ingest:collection_update' pk=collection.pk %}">
        <button class="cancel btn btn-primary" value="ignore" formnovalidate="">Edit</button>
      </a>
          &nbsp;
      <!--<a href="{% url 'ingest:collection_delete' pk=collection.pk %}">
        <button class="cancel btn btn-primary" value="ignore" formnovalidate="">Delete</button>
      </a>-->
          &nbsp;
      <a href="{% url 'ingest:collection_list' %}">
        <button class="cancel btn btn-primary" value="ignore" formnovalidate="">Cancel</button>
      </a>
      </tr>
      </table>
      </p>
      <br><br>
      {% for dataset in datasets_list %}
        <div class="panel panel-default">
          <div class="panel-heading">{{ dataset.title }}</div>
          <div class="panel-body">
            <!--p>{{ dataset.abstract }}</p-->
            <form action="" method="post">
              {% csrf_token %}
              <input type="hidden" name="dataset_id" value="{{ dataset.id }}">
              <div class="input-group">
                <select name="tag_text" class="form-control">
                  {% for tag in consortium_tags %}
                    <option value="{{ tag }}">{{ tag }}</option>
                  {% endfor %}
                </select>
                <span class="input-group-btn">
                  <button class="btn btn-primary" type="submit" name="add_tag">Add Tag</button>
                </span>
              </div>
            </form>
            <ul>
              {% for tag in dataset.tags.all %}
                <li>{{ tag.tag }}</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      {% endfor %}

      {% include 'ingest/new_metadata_sheet.html' %}
      {% include 'ingest/messages.html' %}

    </div>
  </div>
</div>

{% endblock %}
